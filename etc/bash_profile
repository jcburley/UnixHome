#!/bin/bash

[ -r ~/.debug-profiles ] && echo "$0: bash_profile: running" && env

export BASH_PROFILE_HAS_RUN=true

export UNIXHOME=~/.unixhome

# Ensure 'path' utility is in $PATH.
if ! which path >/dev/null; then
    for d in /usr/local/bin; do
        [ -x "$d/path" ] && PATH="${d}${PATH:+:${PATH}}"
    done
    if ! which path >/dev/null; then
        echo >&2 "$0: $UNIXHOME/etc/bash_profile: ERROR: 'path' utility not in \$PATH"
        exit 99
    fi
fi

[ -f "$UNIXHOME"/etc/functions ] && . "$UNIXHOME"/etc/functions

# Pull in .profile, which e.g. MacPorts creates to prepend to $PATH.
[ -f ~/.profile ] && . ~/.profile

# Get the aliases and functions.
if [ -z "$BASHRC_HAS_RUN" ] && [ -f $HOME/.bashrc ]; then
    source $HOME/.bashrc
fi

PATHDIRS="$HOME/bin $HOME/googlesource/depot_tools"

for pd in $PATHDIRS; do
    [ -d "$pd" ] && PATH=$(path --append "$pd")
done

export PATH

# If system has a known manpath configuration file, ensure $MANPATH
# begins with a colon, which means use the config.  Otherwise, ensure
# it has certain canonical directories.

if [ -r /etc/man.conf -o -r /etc/manpath.config ]; then
    MANPATH="$(eval path \"$MANPATH\" --prepend \"\")"
else
    for d in /usr/man /usr/local/man /usr/share/man /usr/local/share/man /usr/X11/man /usr/X11R6/man /opt/man; do
        [ -d "$d" ] && MANPATH="$(eval path \"$MANPATH\" --append \"$d\")"
    done
fi

if [ -d /var/qmail/man ]; then
    MANPATH="$(eval path \"$MANPATH\" --append /var/qmail/man)"
fi

export MANPATH

if [ -n "$PS1" ]; then
    # Use Emacs if installed. (Git bash which does not support -s.)
    if which emacs >/dev/null 2>&1; then
        export EDITOR=emacs
        export GIT_EDITOR=emacs
        export VISUAL=emacs
    fi

    # Get git goodness in prompts. See bashrc for PS1 and PROMPT_COMMAND
    # definitions including $SHLVL. NOTE: __git_ps1 rewrites $PS1!!
    export PS1='[\u@\h \W$(__git_ps1 " (%s)")]\$ '
    export PROMPT_COMMAND='__git_ps1 "\u@\h:\w" "\\\$ "'

    export GIT_PS1_SHOWDIRTYSTATE=t
    export GIT_PS1_SHOWSTASHSTATE=t
    export GIT_PS1_SHOWUPSTREAM="verbose"
fi

export GITBASE=git@github.com:jcburley

# GoLang
if [ -d /usr/local/go ]; then
    export GOROOT=/usr/local/go
    PATH=$(path --append $GOROOT/bin)
fi
if [ -d "$HOME/.go" ]; then
    export GOPATH=$HOME/.go
    PATH=$(path --append $GOPATH/bin)
fi

# Pull in per-session profile, if any:
PSP=~/.unixhome/etc/sessions/${USER}@$(hostname)
[ -f $PSP/profile ] && . $PSP/profile
